define("icybee/images/save-operation",[],function(){return new Class({options:{constructor:"files",url:""},Implements:[Options,Events],initialize:function(e){this.setOptions(e)},process:function(e){var t=new XMLHttpRequest,i=this.createFormData(e);t.onreadystatechange=this.onReadyStateChange.bind(this),t.upload.onprogress=this.onProgress.bind(this),t.upload.onload=this.onProgress.bind(this),t.open("POST",this.options.url),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.setRequestHeader("X-Request","JSON"),this.request(t),t.send(i)},createFormData:function(e){var t=new FormData;return t.append(ICanBoogie.Operation.DESTINATION,this.options.constructor),t.append(ICanBoogie.Operation.NAME,"save"),Object.each(e,function(e,i){t.append(i,e)}),t},onReadyStateChange:function(e){var t=e.target;if(t.readyState==XMLHttpRequest.DONE){if(200==t.status)try{this.success(JSON.decode(t.responseText),t)}catch(e){console&&console.error(e),this.failure(t)}else t.status>=400&&this.failure(t);this.complete(t)}},onProgress:function(e){this.fireEvent("progress",e)},request:function(e){this.fireEvent("request",e)},success:function(e,t){this.fireEvent("success",e,t)},failure:function(e){this.fireEvent("failure",e)},complete:function(e){this.fireEvent("complete",e)}})}),define("icybee/images/image-control",["icybee/images/save-operation"],function(e){return new Class({options:{maxFileSize:0,maxFileSizeAlert:"The selected file is too big.",acceptedExtensions:null,acceptedExtensionsAlert:"Wrong file type."},Implements:[Options,Events],initialize:function(e,t){this.element=e,this.fileElement=e.querySelector('[type="file"]'),this.nidElement=e.querySelector('[type="hidden"]'),this.progressPositionElement=e.querySelector(".progress-position"),this.alertContentElement=e.querySelector(".alert .content"),this.defaultAlertMessage=this.alertContentElement.innerHTML,this.setOptions(t),"string"==typeOf(this.options.acceptedExtensions)&&(this.options.acceptedExtensions=this.options.acceptedExtensions.split(" ")),this.fileElement.addEvent("change",function(e){this.start()}.bind(this)),e.addEventListener("dragover",this.onDragover.bind(this),!1),e.addEventListener("dragleave",this.onDragleave.bind(this),!1),e.addEventListener("drop",this.onDrop.bind(this),!1)},onDragover:function(e){e.preventDefault(),this.element.addClass("dnd-hover")},onDragleave:function(e){e.preventDefault(),this.element.removeClass("dnd-hover")},onDrop:function(e){e.stopPropagation(),e.preventDefault(),this.element.removeClass("dnd-hover");var t=e.target.files||e.dataTransfer.files;this.upload(t[0])},setPosition:function(e){this.progressPositionElement.setStyle("width",100*e+"%"),this.element.querySelector(".progress-label").innerHTML=Math.round(100*e)+"%"},alert:function(e){this.alertContentElement.innerHTML=e,this.element.addClass("has-error")},validate:function(e){var t=this.options.acceptedExtensions,i=this.options.maxFileSize;return t&&(t=t.join("|").replace(/\./g,""),t=new RegExp(".("+t+")$"),!t.test(e.name))?(this.alert(this.options.acceptedExtensionsAlert),!1):!(e.size>i)||(this.alert(this.options.maxFileSizeAlert),!1)},start:function(){var e=this.fileElement.files;this.upload(e[0])},upload:function(t){if(this.validate(t)){var i=new e({constructor:"images",onRequest:this.request.bind(this),onSuccess:this.success.bind(this),onFailure:this.failure.bind(this),onComplete:this.complete.bind(this),onProgress:this.progress.bind(this)}),n=this.nidElement.get("value"),s={path:t,is_online:!0};n&&(s[ICanBoogie.Operation.KEY]=n),i.process(s)}},request:function(e){this.setPosition(0),this.element.removeClass("has-error"),this.element.addClass("uploading"),this.fireEvent("request",arguments)},success:function(e,t){this.setValue(e.rc.key),this.fireEvent("success",arguments)},failure:function(e){var t=this.defaultAlertMessage;try{response=JSON.decode(e.responseText),response.errors.path?t=response.errors.path:response.exception&&(t=response.errors.path)}catch(e){}this.alert(t),this.fireEvent("failure",arguments)},complete:function(e){this.element.removeClass("uploading"),this.fireEvent("complete",arguments)},progress:function(e){if(e.lengthComputable){var t=e.loaded/e.total;this.setPosition(t)}this.fireEvent("progress",arguments)},setValue:function(e){this.nidElement.value=e,this.fireEvent("change",e)},getValue:function(){return this.nidElement.value}})}),!function(e){var t;e.register("ImageControl",function(e,i){return t||(t=require("icybee/images/image-control")),new t(e,i)})}(Brickrouge),define("icybee/images/image-control-with-preview",["brickrouge"],function(e){return new Class({options:{thumbnailVersion:"$popimage"},initialize:function(t,i){var n;this.element=t=document.id(t),this.imgElement=t.getElement("img"),this.control=n=e.from(t.getElement("["+e.IS_ATTRIBUTE+"]")),this.control.addEvent("change",this.rethinkState.bind(this)),t.addEventListener("dragover",function(e){n.onDragover(e)},!1),t.addEventListener("dragleave",function(e){n.onDragleave(e)},!1),t.addEventListener("drop",function(e){n.onDrop(e)},!1),t.addEvent('click:relay([data-dismiss="value"])',function(){this.setValue(null)}.bind(this)),this.rethinkState()},rethinkState:function(){var e=this.getValue(),t=0|e?"/api/images/"+e+"/thumbnails/"+this.options.thumbnailVersion+"?no-cache="+(new Date).getTime().toString(16):"";this.imgElement.src=t,this.element[t?"removeClass":"addClass"]("empty")},setValue:function(e){this.control.setValue(e),this.rethinkState()},getValue:function(e){return this.control.getValue()}})}),!function(e){var t;e.register("ImageControlWithPreview",function(e,i){return t||(t=require("icybee/images/image-control-with-preview")),new t(e,i)})}(Brickrouge),define("icybee/images/adjust-image",["icybee/nodes/adjust-node"],(e=>{return e})),!function(e){let t;e.register("AdjustImage",((e,i)=>{return t||(t=require("icybee/images/adjust-image")),new t(e,i)}))}(Brickrouge),define("icybee/images/adjust-thumbnail",["brickrouge","icybee/thumbnailer/thumbnail"],((e,t)=>{return new Class({Implements:[Events],initialize:function(t,i){this.element=t,this.control=t.querySelector('input[type="hidden"]'),this.thumbnailOptions=e.from(t.querySelector(".widget-adjust-thumbnail-options")),this.thumbnailOptions.addEvent("change",this.onChange.bind(this)),this.adjustImage=e.from(t.querySelector(".widget-adjust-image")),this.adjustImage.observeChange(this.onChange.bind(this)),t.getFirst(".more").addEvent("click",function(e){this.element.toggleClass("unfold-thumbnail"),this.fireEvent("adjust",{target:this.element,widget:this})}.bind(this))},decodeOptions:function(e){const t=e.match(/\/images\/(\d+|[^\/]+)(\/(\d*)x(\d*)(\/([a-z\-]+))?)?/),i=t[1],n=t[3]||null,s=t[4]||null,o=t[6],r=e.indexOf("?");let a={};return r&&(a=e.substring(r+1).parseQueryString()),i&&(a.nid=i),a.width=n,a.height=s,a.method=o,a},setValue:function(e){let t={nid:null},i=null;"element"==typeOf(e)&&(i=e,e=i.get("data-nid")||i.get("src")),"string"==typeOf(e)&&e.indexOf("/images/")!==-1?t=this.decodeOptions(e):"object"==typeOf(e)?t=e:t.nid=e,i&&(t.width=i.get("width")||t.width,t.height=i.get("height")||t.height),this.adjustImage.value=t.nid,this.thumbnailOptions.setValue(t)},getValue:function(){const e=this.adjustImage.selected,i=this.thumbnailOptions.getValue();let n=null,s=null;if(e){let o=e.get("data-nid");try{s=new t("/images/"+o,i),n=s.toString()}catch(e){console&&console.log(e)}}return n},onChange:function(e){this.fireEvent("change",{target:this,url:this.getValue(),nid:e.value,selected:e.selected,options:this.thumbnailOptions.getValue()})}})})),!function(e){let t;e.register("AdjustThumbnail",function(e,i){return t||(t=require("icybee/images/adjust-thumbnail")),new t(e,i)})}(Brickrouge),define("icybee/images/pop-image",["icybee/nodes/pop-node"],function(e){const t={thumbnailVersion:"$popimage"};return class extends e{constructor(e,i){super(e,Object.assign({},t,i));this.img=e.querySelector("img");this.loader=this.createLoader(this.img)}change(e){this.value=parseInt(e.selected.get("data-nid"))}formatValue(e){const t=this.img;if(!e)return"";this.updateThumbnail(e);return t}createLoader(e){const t=document.createElement("img");t.onload=function(){var i=e.parentNode;i.removeChild(e);e.setAttribute("width",t.naturalWidth);e.setAttribute("height",t.naturalHeight);e.src=t.src;i.appendChild(e);if(this.popover){this.popover.reposition()}}.bind(this);return t}updateThumbnail(e){this.loader.src="/images/"+e+"/thumbnails/"+this.options.thumbnailVersion+"?_r="+Date.now()}}}),!function(e){let t;e.register("PopImage",((e,i)=>{return t||(t=require("icybee/images/pop-image")),new t(e,i)}))}(Brickrouge),define("icybee/images/pop-or-upload-image",["brickrouge"],function(e){const t="upload-mode",i="create",n="update";class s{constructor(t,i){this.element=t;this.options=i;const s=e.from(t.querySelector(".widget-pop-image"));const o=e.from(t.querySelector(".widget-file"));let r=null;if(o.options.uploadMode==n){r=s.value}o.observePrepare((e=>{const t=e.data;t.append("title",e.file.name);t.append("is_online",true);if(r){t.append(ICanBoogie.Operation.KEY,r)}}));o.observeSuccess((e=>{s.value=e.response.rc.key}))}}return Object.defineProperties(s,{UPLOAD_MODE:{value:t},UPLOAD_MODE_CREATE:{value:i},UPLOAD_MODE_UPDATE:{value:n}}),s}),!function(e){let t;e.register("PopOrUploadImage",((e,i)=>{return t||(t=require("icybee/images/pop-or-upload-image")),new t(e,i)}))}(Brickrouge);
//# sourceMappingURL=public/module.js.map
